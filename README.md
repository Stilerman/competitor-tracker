# Инструкция по установке и запуску системы мониторинга конкурентов

## Требования к системе
- Python 3.8 или выше
- pip (менеджер пакетов Python)
- Доступ в интернет

## Шаг 1: Подготовка файлов

1. Создайте новую папку для проекта, например `competitor_tracker`
2. Поместите все файлы в эту папку:
   - `app.py` - основной файл приложения
   - `competitor_parser.py` - скрипт парсинга
   - Создайте папку `templates` и поместите в неё все HTML-шаблоны

## Шаг 2: Создание виртуального окружения и установка зависимостей

Откройте командную строку (терминал) и перейдите в директорию проекта:

```bash
cd путь/к/папке/competitor_tracker
```

### Создание виртуального окружения

#### Windows:
```bash
python -m venv venv
venv\Scripts\activate
```

#### Linux/Mac:
```bash
python3 -m venv venv
source venv/bin/activate
```

### Установка зависимостей

```bash
pip install Flask pandas feedparser requests lxml Werkzeug Flask-Login Flask-SocketIO plotly cssselect fake-useragent
```

## Шаг 3: Создание необходимых папок

```bash
mkdir data
```

## Шаг 4: Запуск приложения

```bash
python app.py
```

После запуска, приложение будет доступно по адресу: http://localhost:5000

При первом запуске вы сможете войти с учетными данными по умолчанию:
- Логин: `admin`
- Пароль: `admin`

## Шаг 5: Настройка конкурентов

1. Войдите в систему
2. Перейдите в раздел "Конкуренты"
3. Добавьте нового конкурента, указав:
   - Название
   - Тип источника (RSS или XML-карта)
   - URL источника
   - Тип селекторов (XPath или CSS)
   - Селекторы для просмотров и даты

## Примечания по использованию

### Типы парсинга

1. **Обычный парсинг** (кнопка "Запустить" на главной странице)
   - Парсит только новые статьи из источника
   - Не обновляет данные для уже спаршенных URL

2. **Полный парсинг** (кнопка "Запустить полный парсинг" в редактировании конкурента)
   - Парсит все URL из источника
   - Обновляет данные для уже спаршенных URL (просмотры и даты)
   - Рекомендуется запускать редко из-за возможной блокировки

### Настройка для обхода блокировок

Для улучшения обхода блокировок можно:

1. Отредактировать список User-Agent в файлах `app.py` и `competitor_parser.py`
2. Добавить свои прокси-серверы в список PROXIES в этих же файлах
3. Изменить задержки между запросами в функции `parse_article` в файле `competitor_parser.py`

### Запуск парсера по расписанию

Для автоматического запуска парсера можно настроить планировщик задач:

#### Windows (Task Scheduler):
1. Откройте "Планировщик заданий"
2. Создайте новую задачу
3. Укажите путь к интерпретатору Python и скрипту: `путь/к/venv/python.exe путь/к/competitor_parser.py`
4. Настройте расписание (например, ежедневно в 8:00)

#### Linux/Mac (Cron):
1. Откройте crontab для редактирования: `crontab -e`
2. Добавьте строку для ежедневного запуска в 8:00:
   ```
   0 8 * * * cd /путь/к/проекту && /путь/к/venv/bin/python /путь/к/проекту/competitor_parser.py
   ```

## Устранение проблем

### Проблема с кодировкой

Если возникают проблемы с кодировкой и отображением кириллицы:

1. Убедитесь, что все файлы сохранены в кодировке UTF-8
2. Для Windows-систем может потребоваться дополнительная настройка:
   ```python
   # В скрипте competitor_parser.py
   sys.stdout.reconfigure(encoding='utf-8')
   ```

### Ошибки при парсинге

Если парсер не может получить данные:

1. Проверьте правильность селекторов (XPath или CSS)
2. Убедитесь, что URL источника доступен
3. Проверьте логи в файле `parser.log`

### Ошибки с библиотеками

Если возникают ошибки с отсутствующими библиотеками:

```bash
pip install -r requirements.txt
```

Если библиотека pandas не устанавливается из-за ошибок компиляции:

```bash
pip install --only-binary :all: pandas
```
